# Development Dockerfile for backend
FROM node:18-alpine

# Install system dependencies
RUN apk add --no-cache libc6-compat curl && \
    npm install -g pnpm@8.15.4

# Set working directory
WORKDIR /app

# Create non-root user and directories
RUN addgroup --system --gid 1001 nodejs && \
    adduser --system --uid 1001 nestjs && \
    mkdir -p /app/data/uploads && \
    chown -R nestjs:nodejs /app

# Switch to non-root user
USER nestjs

# Expose port
EXPOSE 3002

# Start development server with database setup
CMD ["sh", "-c", "cd apps/backend && pnpm install && pnpm prisma generate && pnpm prisma migrate dev && pnpm prisma db seed && pnpm start:dev"] 